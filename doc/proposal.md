# Galuchat API 活用・GPSログ要約サーバー計画

---

## 1. プロジェクトの狙い

* 個人の GPS ログを、\*\*「どの地区にいたか」\*\*の情報へ自動変換する。
* 現状は「座標 → 地区名」を返すシンプルな仕組みを提供。
* 将来的には「座標 → 地区ごとのメタデータ（人口・用途地域・統計値など）」を返し、よりリッチな要約が可能になる。
* 趣味的な実験として、自分や身近な人が気軽に使える「位置ログ要約サービス」を作る。
* 目的のひとつとして **「GPSログから旅行記を生成する」** ことも目指す。

---

## 2. 現状でできること

1. **単点逆ジオ**

   * 緯度経度を渡すと、その座標が属する行政区画（市区町村、小地域、JCC/JCG）を返す。
   * 例: `35.6812, 139.7671 → 千代田区`

2. **ログ全体の地区名リスト化**

   * GPSログ（座標列）を入力 → 訪問した地区名の一覧を返す。
   * 例: `[千代田区, 中央区, 港区]`

3. **訪問履歴の要約（簡易版）**

   * ログの順序に従って「どの区を訪れたか」を短文にまとめる。
   * 例: 「千代田区→中央区→港区を移動」

---

## 3. GPSログのパターンと対応方針

GPSログの形式によって処理の深さを変える。現状のサーバーは次の三形態を想定：

* **A. 時刻つき時系列ログ**
  滞在時間や移動距離を含む要約が可能。旅行記生成にも利用できる。

* **B. 座標の集合（順序・時刻なし）**
  訪問した地区のリストアップに特化。順序や滞在時間は不明。簡易な集合要約を返す。

* **C. 順序のみあるログ（時刻なし）**
  訪問順の要約や距離概算が可能。滞在時間は推定扱いとし、必要に応じて補助パラメータで推測する。

---

## 4. 想定する利用シーン

* **日常ログまとめ**
  今日どこの区を歩いたか、簡単に表示して日記代わりにする。
* **旅行ログ**
  移動の軌跡を地区名で振り返り、SNSやブログに貼る。
* **旅行記生成（目的のひとつ）**
  GPSログを日ごとに区切り、「Day1: 東京→名古屋、Day2: 京都→大阪」などの旅行記を自動で整形。
* **写真整理**
  EXIF の座標から地名を自動付与し、1日の行動とともに並べる。
* **アマチュア無線**
  座標から自動で JCC/JCG コードを付与し、交信ログを整形。

---

## 5. システム構成（概要）

* **MCPサーバー（PHP予定）**

  * クライアントからログを受け取り → Galuchat API に問い合わせ → 地区名を返す。
  * 入力ログの形態に応じて「詳細要約」「集合要約」「順序のみの要約」を切り替える。
* **Galuchat API（既存）**

  * 行政区・小地域・JCC/JCG コードを逆ジオコーディング。
  * 今後、地区単位のメタデータ提供にも拡張予定。

---

## 6. MCPサーバーとLLMの役割分担

* **LLM（呼び出し側）**

  * ユーザーの入力（CSV/GPX/自然文）を整形し、MCPが受け入れられるJSON形式に変換。
  * 必要に応じてモード（時刻あり／集合／順序のみ）を明示。
  * サーバーの入力スキーマに合わせた正規化を担当。

* **MCPサーバー（中継側）**

  * シンプルなツールを公開し、入力は厳格スキーマで受け付ける。
  * 曖昧な解釈や推測は行わず、与えられたモードに従って決定論的に処理。
  * 出力は要約文・地区情報・統計など最小限に限定。

---

## 7. 出力イメージ（現状）

* **単点要約**
  入力: `{"lat":35.6812,"lon":139.7671}`
  出力: `{"code":"13101","name":"東京都千代田区"}`

* **ログ要約（順序あり）**
  入力: 複数座標
  出力: `{"areas":["千代田区","中央区","港区"]}`
  要約文: 「千代田区→中央区→港区を移動」

* **旅行記生成（将来像）**

  ```
  【Day 1】 東京→名古屋（約350km移動）
  午後は名古屋市中区に2時間滞在。

  【Day 2】 名古屋→京都→大阪（約150km移動）
  京都市東山区で3時間の滞在。
  ```

---

## 8. プライバシーと設計方針

* 座標データは保存しない（処理後に即破棄）。
* 出力は最小限（地区名やコード）に留める。
* 境界付近では不安定な結果を避けるため、一定の正規化を行う。
* 趣味利用前提なので、負荷対策はシンプル（レート制御程度）。

---

## 9. まとめ

* 本プロジェクトは「GPSログを地区名で要約する MCPサーバー」を実装し、趣味的に活用する試み。
* 入力形式の整形やモード判断は LLM 側に任せ、MCPサーバーは単純で厳密な処理に徹する。
* 現状では「座標→地区名」を返すのみだが、将来的に「地区ごとのメタデータ」や「旅行記自動生成」へ拡張することを目指す。
